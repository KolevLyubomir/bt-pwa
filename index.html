<!doctype html>
<html lang="bg">
<head>
  <meta charset="utf-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1"/>
  <title>БТ App 4 — v4.1.11</title>

  <meta http-equiv="Cache-Control" content="no-cache, no-store, must-revalidate"/>
  <meta http-equiv="Pragma" content="no-cache"/>
  <meta http-equiv="Expires" content="0"/>

  <meta name="theme-color" content="#0b1215"/>
  <link rel="manifest" href="manifest.webmanifest?v=1.39"/>
  <link rel="icon" href="assets/icons/icon-192.png?v=1.39"/>

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Marcellus&family=Montserrat:wght@400;600;700&display=swap"/>

  <link rel="stylesheet"
        href="https://fonts.googleapis.com/css2?family=Great+Vibes&display=swap"/>

  <link rel="stylesheet" href="assets/css/main.css"/>
  <link rel="stylesheet" href="assets/css/data.css"/>
  <link rel="stylesheet" href="assets/css/program.css"/>


</head>
<body>

  <div class="topbar-wrap">
    <div class="topbar">
      <div class="brand">
        <img src="https://bezopasnoteglo.carrd.co/assets/images/...mage08.png?v=7cf47ba0" alt="Безопасно Тегло" class="main-logo"/>
      </div>
      <div class="version-slot">
        <span class="badge" id="app-version-badge">v4.1.11</span>
      </div>
    </div>
  </div>

  <div class="tabs-wrap" role="navigation" aria-label="Навигация">
    <div class="tabs" role="tablist">
      <button id="tab-data" class="tab-btn" role="tab" aria-controls="panel-data" aria-selected="true">Данни</button>
      <button id="tab-program" class="tab-btn" role="tab" aria-controls="panel-program" aria-selected="false">Програма</button>
    </div>
  </div>

  <div id="panel-data" class="tabpanel" role="tabpanel" aria-labelledby="tab-data" aria-hidden="false">
    <main>
      <section class="card">
        <h2 style="margin:0 0 10px">Запис</h2>

        <div class="data-grid">
          <div class="field date">
            <div class="lbl">Дата</div>
            <div class="ctl">
              <div class="date-wrap">
                <input id="dateText" type="text" readonly placeholder="ДД.ММ.ГГ"/>
                <div id="cal" class="cal" role="dialog" aria-label="Календар"></div>
              </div>
            </div>
            <div class="field weight">
              <div class="lbl">Тегло (kg)</div>
              <div class="ctl">
                <input id="weight" type="number" step="0.1" min="0.1" placeholder="107.7"/>
              </div>
            </div>
            <div class="field" style="min-width:var(--ctl-h)">
              <div class="lbl"></div>
              <label class="bt-only" title="Маркиран като БТ"><input id="btFlag" type="checkbox" checked/></label>
            </div>
            <div class="field" style="min-width:var(--ctl-h)">
              <div class="lbl"></div>
              <button id="btnSave" class="btn primary" type="button">Запиши</button>
            </div>
          </div>
        </div>
      </section>

      <section class="card">
        <h2 style="margin:0 0 10px">Графика</h2>

        <div class="chart-wrap">
          <div class="chart-header">
            <div class="chart-title">Тегло</div>
            <div class="chart-controls">
              <button id="btnRange7" class="chip chip-sm chip-on" type="button" data-range="7">7 дни</button>
              <button id="btnRange30" class="chip chip-sm" type="button" data-range="30">30 дни</button>
              <button id="btnRange90" class="chip chip-sm" type="button" data-range="90">90 дни</button>
              <button id="btnRangeAll" class="chip chip-sm" type="button" data-range="all">Всички</button>
            </div>
          </div>
          <div class="chart-main">
            <canvas id="weightChart" aria-label="Графика на теглото"></canvas>
          </div>
        </div>
      </section>

      <section class="card">
        <h2 style="margin:0 0 10px">Записи</h2>

        <div class="records-wrap">
          <div class="records-controls">
            <div class="records-filter">
              <label>
                <input id="filterBtOnly" type="checkbox" checked/>
                <span>Само БТ</span>
              </label>
            </div>
            <button id="btnDeleteAll" class="btn secondary danger" type="button">Изтрий всички</button>
          </div>

          <div class="records-list" id="recordsList" aria-label="Списък записи по дати">
            <!-- попълва се динамично -->
          </div>
        </div>
      </section>
    </main>
  </div>

  <div id="panel-program" class="tabpanel" role="tabpanel" aria-labelledby="tab-program" aria-hidden="true">
    <main>
      <section class="card" id="pkg-core">
        <h2 class="pkg-title">Основен Пакет</h2>

        <div id="prolact-block">
          <div class="prog-head">
            <div class="prog-head-main">
              <img class="prod-img" src="assets/products/basic/prolact.webp" alt="ProLact Slim+"/>
              <span class="prog-cap">ProLact Slim+</span>
            </div>
            <button id="btnProgIntakePL" class="clk-btn intake prog-intake-btn" type="button" title="Прием ProLact Slim+" style="display:none">
              <span class="clk-btn-icon">
                <svg viewBox="0 0 24 24" fill="none">
                  <g transform="translate(12,12)">
                    <circle class="pill-clock-face" r="10"></circle>
                    <path class="pill-clock-hand" d="M0 -5V1"></path>
                    <path class="pill-clock-pill" d="M0 1l3 3"></path>
                  </g>
                </svg>
              </span>
            </button>
          </div>
          <div class="pl-wrap">
            <table class="pl-table" id="pl-table">
              <thead>
                <tr>
                  <th class="pl-day" data-dow="1">Пн</th>
                  <th class="pl-day" data-dow="2">Вт</th>
                  <th class="pl-day" data-dow="3">Ср</th>
                  <th class="pl-day" data-dow="4">Чт</th>
                  <th class="pl-day" data-dow="5">Пт</th>
                  <th class="pl-day weekend" data-dow="6">Сб</th>
                  <th class="pl-day weekend" data-dow="0">Нд</th>
                </tr>
              </thead>
              <tbody>
                <!-- попълва се динамично -->
              </tbody>
            </table>
          </div>
        </div>

        <div id="hetox-block">
          <div class="prog-head">
            <div class="prog-head-main">
              <img class="prod-img" src="assets/products/basic/hetox.webp" alt="Omni-Biotic Hetox Light"/>
              <span class="prog-cap">Omni-Biotic Hetox Light</span>
            </div>
            <button id="btnProgIntakeOB" class="clk-btn intake prog-intake-btn" type="button" title="Прием Omni-Biotic Hetox Light" style="display:none">
              <span class="clk-btn-icon">
                <svg viewBox="0 0 24 24" fill="none">
                  <g transform="translate(12,12)">
                    <circle class="pill-clock-face" r="10"></circle>
                    <path class="pill-clock-hand" d="M0 -5V1"></path>
                    <path class="pill-clock-pill" d="M0 1l3 3"></path>
                  </g>
                </svg>
              </span>
            </button>
          </div>
          <div class="pl-wrap">
            <table class="pl-table" id="ob-table">
              <thead>
                <tr>
                  <th class="pl-day" data-dow="1">Пн</th>
                  <th class="pl-day" data-dow="2">Вт</th>
                  <th class="pl-day" data-dow="3">Ср</th>
                  <th class="pl-day" data-dow="4">Чт</th>
                  <th class="pl-day" data-dow="5">Пт</th>
                  <th class="pl-day weekend" data-dow="6">Сб</th>
                  <th class="pl-day weekend" data-dow="0">Нд</th>
                </tr>
              </thead>
              <tbody>
                <!-- попълва се динамично -->
              </tbody>
            </table>
          </div>
        </div>

        <div id="glucoman-block">
          <div class="prog-head">
            <div class="prog-head-main">
              <img class="prod-img" src="assets/products/basic/glucoman.webp" alt="Глюкоманан"/>
              <span class="prog-cap">Глюкоманан</span>
            </div>
            <button id="btnProgIntakeGM" class="clk-btn intake prog-intake-btn" type="button" title="Прием Глюкоманан" style="display:none">
              <span class="clk-btn-icon">
                <svg viewBox="0 0 24 24" fill="none">
                  <g transform="translate(12,12)">
                    <circle class="pill-clock-face" r="10"></circle>
                    <path class="pill-clock-hand" d="M0 -5V1"></path>
                    <path class="pill-clock-pill" d="M0 1l3 3"></path>
                  </g>
                </svg>
              </span>
            </button>
          </div>
          <div class="pl-wrap">
            <table class="pl-table" id="gm-table">
              <thead>
                <tr>
                  <th class="pl-day" data-dow="1">Пн</th>
                  <th class="pl-day" data-dow="2">Вт</th>
                  <th class="pl-day" data-dow="3">Ср</th>
                  <th class="pl-day" data-dow="4">Чт</th>
                  <th class="pl-day" data-dow="5">Пт</th>
                  <th class="pl-day weekend" data-dow="6">Сб</th>
                  <th class="pl-day weekend" data-dow="0">Нд</th>
                </tr>
              </thead>
              <tbody>
                <!-- попълва се динамично -->
              </tbody>
            </table>
          </div>
        </div>

        <div id="chitosan-block">
          <div class="prog-head">
            <div class="prog-head-main">
              <img class="prod-img" src="assets/products/basic/chitosan.webp" alt="Хитозан плюс"/>
              <span class="prog-cap">Хитозан плюс</span>
            </div>
            <button id="btnProgIntakeCH" class="clk-btn intake prog-intake-btn" type="button" title="Прием Хитозан плюс" style="display:none">
              <span class="clk-btn-icon">
                <svg viewBox="0 0 24 24" fill="none">
                  <g transform="translate(12,12)">
                    <circle class="pill-clock-face" r="10"></circle>
                    <path class="pill-clock-hand" d="M0 -5V1"></path>
                    <path class="pill-clock-pill" d="M0 1l3 3"></path>
                  </g>
                </svg>
              </span>
            </button>
          </div>
          <div class="pl-wrap">
            <table class="pl-table" id="ch-table">
              <thead>
                <tr>
                  <th class="pl-day" data-dow="1">Пн</th>
                  <th class="pl-day" data-dow="2">Вт</th>
                  <th class="pl-day" data-dow="3">Ср</th>
                  <th class="pl-day" data-dow="4">Чт</th>
                  <th class="pl-day" data-dow="5">Пт</th>
                  <th class="pl-day weekend" data-dow="6">Сб</th>
                  <th class="pl-day weekend" data-dow="0">Нд</th>
                </tr>
              </thead>
              <tbody>
                <!-- попълва се динамично -->
              </tbody>
            </table>
          </div>
        </div>
      </section>

      <section class="card" id="pkg-extra">
        <h2 class="pkg-title">Допълнителен Пакет</h2>

        <div class="config-block" id="ber-block">
          <div class="prog-head">
            <div class="prog-head-main">
              <img class="prod-img" id="ber-img" src="assets/products/additional/ber-thorne.webp" alt="Berberine"/>
              <span class="prog-cap" id="ber-cap">Берберин</span>
            </div>
            <button id="btnProgIntakeBER" class="clk-btn intake prog-intake-btn" type="button" title="Прием Берберин" style="display:none">
              <span class="clk-btn-icon">
                <svg viewBox="0 0 24 24" fill="none">
                  <g transform="translate(12,12)">
                    <circle class="pill-clock-face" r="10"></circle>
                    <path class="pill-clock-hand" d="M0 -5V1"></path>
                    <path class="pill-clock-pill" d="M0 1l3 3"></path>
                  </g>
                </svg>
              </span>
            </button>
          </div>

          <div id="ber-config" class="config-panel" style="display:none">
            <div class="config-row">
              <label class="cfg-label" for="ber-brand-select">Избери:</label>
              <div class="cfg-ctl">
                <button type="button" class="brand-picker-btn" id="ber-brand-picker">
                  <img src="assets/products/additional/icons/ber-thorne-icon.webp" alt="Thorne Research" class="brand-picker-icon" id="ber-brand-picker-icon"/>
                  <span class="brand-picker-label" id="ber-brand-picker-label">Thorne Research</span>
                </button>

                <select id="ber-brand-select">
                  <option value="thorne">Thorne Research</option>
                  <option value="toniiq">Toniiq - Ultra High Strength</option>
                  <option value="it">Integrative Therapeutics</option>
                  <option value="nutricost">Nutricost</option>
                  <option value="now">NOW Foods - Berberine Glucose</option>
                  <option value="custom">Друго (въведи):</option>
                </select>
              </div>
            </div>

            <div id="ber-custom-name-field" class="config-row" style="display:none">
              <label class="cfg-label" for="ber-name">Име:</label>
              <div class="cfg-ctl">
                <input id="ber-name" type="text" placeholder="Въведи име на продукта"/>
              </div>
            </div>

            <div class="config-row">
              <label class="cfg-label" for="ber-slider">Брой приеми:</label>
              <div class="cfg-ctl">
                <div class="slider-row">
                  <input id="ber-slider" type="range" min="1" max="6" step="1" value="3"/>
                  <div class="slider-track">
                    <div class="slider-track-fill" id="ber-slider-track-fill"></div>
                  </div>
                  <span id="ber-slider-val" class="slider-val">3</span>
                </div>
              </div>
            </div>

            <div class="config-actions">
              <button id="ber-save" class="btn primary" type="button">Запази</button>
              <button id="ber-delete" class="btn secondary danger" type="button">Изтрий</button>
            </div>
          </div>

          <div class="pl-wrap" id="ber-grid-container" style="display:none"></div>
        </div>
      </section>

      <section class="card" id="pkg-personal">
        <h2 class="pkg-title">Личен Режим</h2>
        <p style="margin:0 0 8px; color:#9fb4ad">
          Тук включваш други добавки/витамини/медикаменти, които не са част от пакета, но искаш да следиш.
        </p>

        <div id="pers-block">
          <div class="prog-head">
            <div class="prog-head-main">
              <img class="prod-img" src="assets/products/personal/custom.webp" alt="Личен Режим"/>
              <span class="prog-cap">Добави личен режим</span>
            </div>
          </div>

          <div class="personal-config">
            <div class="config-row">
              <label class="cfg-label" for="pers-name">Име:</label>
              <div class="cfg-ctl">
                <input id="pers-name" type="text" placeholder="Например: Витамин D3, Магнезий, Омега 3..."/>
              </div>
            </div>

            <div class="config-row">
              <label class="cfg-label" for="pers-times">Брой приеми:</label>
              <div class="cfg-ctl">
                <div class="slider-row">
                  <input id="pers-times" type="range" min="1" max="6" step="1" value="3"/>
                  <div class="slider-track">
                    <div class="slider-track-fill" id="pers-slider-track-fill"></div>
                  </div>
                  <span id="pers-times-val" class="slider-val">3</span>
                </div>
              </div>
            </div>

            <div class="config-actions">
              <button id="pers-save" class="btn primary" type="button">Запази</button>
              <button id="pers-delete" class="btn secondary danger" type="button">Изчисти</button>
            </div>
          </div>

          <div class="pl-wrap" id="pers-grid-container" style="display:none"></div>
        </div>
      </section>
    </main>
  </div>

  <div id="toast" class="toast" role="status" aria-live="polite" aria-atomic="true"></div>

  <div id="clk" class="clk" aria-hidden="true">
    <div class="clk-card" role="dialog" aria-modal="true" aria-label="Часовник за избор на час">
      <div class="clk-header">
        <div class="clk-product" id="clkProductName">Продукт</div>
        <div class="clk-date" id="clkDateLabel">ден / дата</div>
      </div>

      <div class="clk-clock">
        <div class="clk-face">
          <div class="clk-center-dot"></div>
          <div class="clk-hand" id="clkHand"></div>
          <div class="clk-hand-tail"></div>

          <div class="clk-ticks">
            <!-- генерира се от JS -->
          </div>
        </div>
      </div>

      <div class="clk-footer">
        <div class="clk-chosen">
          <span class="clk-chosen-label">Избран час:</span>
          <span class="clk-chosen-value" id="clkChosen">--:--</span>
        </div>
        <div class="clk-actions">
          <button id="btnClkCancel" class="btn secondary" type="button">Откажи</button>
          <button id="btnClkSave" class="btn primary" type="button">Запази</button>
        </div>
        <div class="clk-audio">
          <button id="btnAudio" class="clk-btn audio big" type="button" title="Аудио вкл/изкл за този час">
            <span class="clk-btn-icon"><svg viewBox="0 0 24 24" fill="none"><g transform="translate(12,12)"><path d="M-4 -4L-1 -4L2 -7L2 7L-1 4L-4 4Z"></path><path d="M4 -5A5 5 0 0 1 4 5"></path><path d="M7 -7A8 8 0 0 1 7 7"></path></g></svg></span>
          </button>
        </div>
      </div>
    </div>
  </div>

  <script>
    (function(){
      try{
        var todayHeader = document.querySelector('.pl-day.today');
        if(!todayHeader) return;
        var dowAttr = todayHeader.getAttribute('data-dow');
        var dow = parseInt(dowAttr, 10);
        if(isNaN(dow)) return;
        var cells = document.querySelectorAll('.pl-time-cell[data-dow="'+ dow +'"]');
        cells.forEach(function(td){
          td.classList.add('today');
        });
      }catch(e){}
    })();
  </script>

  <script src="assets/js/main.js"></script>
  <script src="assets/js/data.js"></script>
  <script src="assets/js/product-grid.js"></script>
  <script src="assets/js/modal.js"></script>
  <script src="assets/js/program-init.js"></script>
  <script src="assets/js/program-additional.js"></script>

</body>
</html>
